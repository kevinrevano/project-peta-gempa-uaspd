<!DOCTYPE html>
<html>
<head>
    <title>Peta Segmen Megathrust</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <style>
        html, body { height: 100%; margin: 0; }
        #map { height: 100%; }
    </style>
</head>
<body>

<div id="map"></div>

<script>
const JSON_URL = "https://raw.githubusercontent.com/kevinrevano/project-peta-gempa-uaspd/main/data/sesar.json";

var map = L.map('map').setView([-2, 118], 5);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

function createSegment(lat, lon, km, angle){
    let d = km / 110;
    let rad = angle * Math.PI / 180;

    let dx = Math.cos(rad) * d;
    let dy = Math.sin(rad) * d;

    let w = 0.2;

    return [
        [lat-w, lon-dx],
        [lat+w, lon-dx],
        [lat+w, lon+dx],
        [lat-w, lon+dx]
    ];
}

fetch(JSON_URL)
.then(res => res.json())
.then(data => {
    data.forEach(seg => {

        let angle = 300; // default
        if (seg.nama.toLowerCase().includes("aceh")) angle = 320;
        if (seg.nama.toLowerCase().includes("jawa")) angle = 270;
        if (seg.nama.toLowerCase().includes("ntt")||seg.nama.toLowerCase().includes("flores")) angle=260;

        let polygon = L.polygon(
            createSegment(seg.lat, seg.lon, seg.panjang_segmen_km, angle),
            {
                color:"black",
                fillColor:"#fdae61",
                fillOpacity:0.6
            }
        ).addTo(map);

        polygon.bindPopup(`
            <b>${seg.nama}</b><br>
            Mmax: ${seg.magnitudo_maksimum}<br>
            Panjang: ${seg.panjang_segmen_km} km<br>
            Tahun: ${seg.tahun_gempa_terakhir}
        `);
    });
});
</script>

</body>
</html>