<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Peta Megathrust Indonesia</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    <style>
        #map { height: 100vh; width: 100%; }
    </style>
</head>
<body>

<div id="map"></div>

<script>

// URL SESAR JSON
const dataUrl = "https://raw.githubusercontent.com/kevinrevano/project-peta-gempa-uaspd/main/data/sesar.json";

var map = L.map('map').setView([-2, 118], 5);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 10
}).addTo(map);

fetch(dataUrl)
  .then(res => res.json())
  .then(data => {

    data.forEach(seg => {

      // konversi panjang segmen ke derajat (1 derajat ≈ 111 km)
      let halfLen = (seg.panjang_segmen_km / 111) / 2;

      // ambil arah segmen
      let angleRad = seg.angle * Math.PI / 180;

      // hitung titik-titik kotak
      let dx = halfLen * Math.cos(angleRad);
      let dy = halfLen * Math.sin(angleRad);

      // empat titik kotak
      let p1 = [seg.lat - dy, seg.lon - dx];
      let p2 = [seg.lat + dy, seg.lon + dx];

      let rect = L.rectangle([p1, p2], {
        color: seg.magnitudo_maksimum >= 9 ? "red" :
               seg.magnitudo_maksimum >= 8.5 ? "orange" :
               "yellow",
        weight: 2,
        fillOpacity: 0.4
      }).addTo(map);

      rect.bindPopup(`
        <b>${seg.nama}</b><br>
        Magnitudo Maksimum: ${seg.magnitudo_maksimum}<br>
        Panjang Segmen: ${seg.panjang_segmen_km} km<br>
        Tahun Gempa Terakhir: ${seg.tahun_gempa_terakhir}<br>
        Lokasi: ${seg.lat}, ${seg.lon}<br>
        Arah Segmen: ${seg.angle}°
      `);

    });

  });

</script>
</body>
</html>